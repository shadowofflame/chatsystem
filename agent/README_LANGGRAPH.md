# LangGraph Agent ä½¿ç”¨æŒ‡å—

## æ¶æ„è¯´æ˜

è¿™ä¸ªé¡¹ç›®ç°åœ¨æ”¯æŒä¸¤ç§Agentæ¶æ„ï¼š

### 1. åŸå§‹Chatbot (åŸºäºLangChain)
- ç®€å•çš„å¯¹è¯æœºå™¨äºº
- æ”¯æŒçŸ­æœŸå’Œé•¿æœŸè®°å¿†
- é€‚åˆåŸºç¡€å¯¹è¯åœºæ™¯

### 2. LangGraph Agent (æ–°å¢)
- åŸºäºçŠ¶æ€æœºçš„æ™ºèƒ½Agent
- è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨å·¥å…·
- æ”¯æŒå¤šç§èƒ½åŠ›ï¼š
  - ğŸŒ **ç½‘ç»œæœç´¢** - å®æ—¶ä¿¡æ¯æŸ¥è¯¢
  - ğŸ“ **æ–‡ä»¶æ“ä½œ** - è¯»å†™æ–‡ä»¶ã€ç®¡ç†ç›®å½•
  - ğŸ§® **æ•°å­¦è®¡ç®—** - å¤æ‚è®¡ç®—
  - ğŸ’¬ **æ™ºèƒ½å¯¹è¯** - ç»“åˆè®°å¿†çš„å¯¹è¯

## å·¥ä½œæµç¨‹å›¾

```
ç”¨æˆ·è¾“å…¥
    â†“
æ„å›¾åˆ†æ (LLMåˆ¤æ–­)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç½‘ç»œæœç´¢   â”‚  æ–‡ä»¶æ“ä½œ   â”‚  æ•°å­¦è®¡ç®—   â”‚  æ™®é€šå¯¹è¯   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“            â†“            â†“            â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
            æ£€ç´¢ç›¸å…³è®°å¿†
                  â†“
            ç”Ÿæˆæœ€ç»ˆå“åº”
                  â†“
            ä¿å­˜åˆ°è®°å¿†
```

## å®‰è£…ä¾èµ–

```bash
cd agent
pip install -r requirements.txt
```

æ–°å¢ä¾èµ–ï¼š
- `langgraph` - çŠ¶æ€å›¾æ¡†æ¶
- `beautifulsoup4` - ç½‘é¡µè§£æ
- `duckduckgo-search` - å…è´¹æœç´¢API
- `requests` - HTTPè¯·æ±‚

## ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: åˆ‡æ¢Agentç±»å‹

é€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶ä½¿ç”¨å“ªä¸ªAgentï¼š

```bash
# ä½¿ç”¨åŸå§‹Chatbot
python main.py

# ä½¿ç”¨LangGraph Agent
export USE_LANGGRAPH=true  # Linux/Mac
set USE_LANGGRAPH=true     # Windows CMD
$env:USE_LANGGRAPH="true"  # Windows PowerShell

python main.py
```

æˆ–åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®ï¼š
```
USE_LANGGRAPH=true
```

### æ–¹æ³•2: ç›´æ¥æµ‹è¯•LangGraph Agent

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python test_langgraph.py

# è¿è¡Œç‰¹å®šæµ‹è¯•
python test_langgraph.py chat       # æ™®é€šå¯¹è¯
python test_langgraph.py calc       # æ•°å­¦è®¡ç®—
python test_langgraph.py search     # ç½‘ç»œæœç´¢
python test_langgraph.py file       # æ–‡ä»¶æ“ä½œ
python test_langgraph.py memory     # è®°å¿†åŠŸèƒ½
```

## åŠŸèƒ½æ¼”ç¤º

### 1. æ™®é€šå¯¹è¯
```
ç”¨æˆ·: ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
Agent: æˆ‘æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ ...
```

### 2. æ•°å­¦è®¡ç®—
```
ç”¨æˆ·: å¸®æˆ‘è®¡ç®— 125 * 48 + 360 / 12
Agent: 
ğŸ” æ„å›¾åˆ†æ: calculate - éœ€è¦æ‰§è¡Œæ•°å­¦è®¡ç®—
ğŸ§® æ‰§è¡Œè®¡ç®—
âœ… ç”Ÿæˆå“åº”å®Œæˆ
125 * 48 + 360 / 12 = 6030
```

### 3. ç½‘ç»œæœç´¢
```
ç”¨æˆ·: 2024å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–è·å¾—è€…æ˜¯è°?
Agent:
ğŸ” æ„å›¾åˆ†æ: search - éœ€è¦æŸ¥è¯¢æœ€æ–°ä¿¡æ¯
ğŸŒ æ‰§è¡Œç½‘ç»œæœç´¢: 2024å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–è·å¾—è€…
ã€æœç´¢ç»“æœã€‘
1. 2024å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–...
   ...
```

### 4. æ–‡ä»¶æ“ä½œ
```
ç”¨æˆ·: å¸®æˆ‘åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ test.txtï¼Œå†…å®¹æ˜¯'Hello, LangGraph!'
Agent:
ğŸ” æ„å›¾åˆ†æ: file - éœ€è¦æ‰§è¡Œæ–‡ä»¶æ“ä½œ
ğŸ“ æ‰§è¡Œæ–‡ä»¶æ“ä½œ
âœ… æ–‡ä»¶åˆ›å»ºæˆåŠŸ: workspace/test.txt

ç”¨æˆ·: è¯»å– test.txt æ–‡ä»¶çš„å†…å®¹
Agent:
ğŸ“ æ‰§è¡Œæ–‡ä»¶æ“ä½œ
æ–‡ä»¶å†…å®¹: Hello, LangGraph!
```

### 5. è®°å¿†åŠŸèƒ½
```
ç”¨æˆ·: æˆ‘å«å¼ ä¸‰ï¼Œæˆ‘å–œæ¬¢ç¼–ç¨‹
Agent: ä½ å¥½å¼ ä¸‰ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ...

ç”¨æˆ·: ä½ è¿˜è®°å¾—æˆ‘çš„åå­—å’Œçˆ±å¥½å—ï¼Ÿ
Agent: 
ğŸ“š æ£€ç´¢åˆ° 2 æ¡ç›¸å…³è®°å¿†
å½“ç„¶è®°å¾—ï¼ä½ å«å¼ ä¸‰ï¼Œå–œæ¬¢ç¼–ç¨‹...
```

## é…ç½®é€‰é¡¹

### LangGraph Agent é…ç½®

åœ¨ `langgraph_agent.py` ä¸­ï¼š

```python
agent = LangGraphAgent(
    api_key="your_api_key",           # DeepSeek API Key
    base_url="https://api.deepseek.com",
    model="deepseek-chat",            # æ¨¡å‹åç§°
    memory_dir="./memory_db",         # è®°å¿†å­˜å‚¨ç›®å½•
    workspace_dir="./workspace"       # æ–‡ä»¶å·¥ä½œç©ºé—´
)
```

### ç½‘ç»œæœç´¢é…ç½®

æ”¯æŒä¸¤ç§æœç´¢æ–¹å¼ï¼š

1. **Serper API** (æ¨èï¼Œéœ€è¦API Key)
   ```bash
   export SERPER_API_KEY=your_serper_api_key
   ```
   æ³¨å†Œåœ°å€: https://serper.dev

2. **DuckDuckGo** (å…è´¹ï¼Œæ— éœ€API Key)
   - è‡ªåŠ¨fallback
   - éœ€è¦å®‰è£…: `pip install duckduckgo-search`

## APIæ¥å£

å¯åŠ¨æœåŠ¡åï¼ŒLangGraph Agentä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰è¯·æ±‚ï¼š

### 1. å¯¹è¯æ¥å£
```bash
POST http://localhost:8000/api/chat
Content-Type: application/json

{
  "message": "å¸®æˆ‘æœç´¢æœ€æ–°çš„AIæ–°é—»",
  "session_id": "session_123"
}
```

Agentä¼šè‡ªåŠ¨ï¼š
1. åˆ†ææ„å›¾ï¼ˆæ˜¯å¦éœ€è¦æœç´¢ï¼‰
2. æ‰§è¡Œç½‘ç»œæœç´¢
3. æ•´åˆæœç´¢ç»“æœ
4. ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤

### 2. ç»Ÿè®¡æ¥å£
```bash
GET http://localhost:8000/api/stats
```

## å·¥å…·è¯¦è§£

### FileHandler - æ–‡ä»¶å¤„ç†å·¥å…·
- `read_file(filepath)` - è¯»å–æ–‡ä»¶
- `write_file(filepath, content)` - å†™å…¥æ–‡ä»¶
- `list_files(directory)` - åˆ—å‡ºæ–‡ä»¶
- `delete_file(filepath)` - åˆ é™¤æ–‡ä»¶

å·¥ä½œç›®å½•: `./workspace/`

### WebSearcher - ç½‘ç»œæœç´¢å·¥å…·
- `search(query, num_results)` - æœç´¢æŸ¥è¯¢
- `fetch_url(url)` - è·å–ç½‘é¡µå†…å®¹

### Calculator - è®¡ç®—å™¨å·¥å…·
- `calculate(expression)` - æ‰§è¡Œæ•°å­¦è¡¨è¾¾å¼

## æ„å›¾è¯†åˆ«æœºåˆ¶

LangGraph Agentä½¿ç”¨LLMè‡ªåŠ¨åˆ¤æ–­ç”¨æˆ·æ„å›¾ï¼š

```python
åˆ¤æ–­æ ‡å‡†:
- search: éœ€è¦æœ€æ–°ä¿¡æ¯ã€æ–°é—»ã€å®æ—¶æ•°æ®ã€å¤©æ°”ç­‰
  ä¾‹: "ä»Šå¤©çš„æ–°é—»", "å½“å‰å¤©æ°”", "è‚¡ç¥¨ä»·æ ¼"
  
- file: æ¶‰åŠè¯»å†™æ–‡ä»¶ã€æŸ¥çœ‹ç›®å½•ã€ä¿å­˜å†…å®¹ç­‰
  ä¾‹: "åˆ›å»ºæ–‡ä»¶", "è¯»å–é…ç½®", "ä¿å­˜æ•°æ®"
  
- calculate: éœ€è¦æ•°å­¦è®¡ç®—ã€æ•°æ®å¤„ç†
  ä¾‹: "è®¡ç®—123*456", "æ±‚å’Œ", "è½¬æ¢å•ä½"
  
- chat: æ™®é€šå¯¹è¯ã€å›ç­”çŸ¥è¯†æ€§é—®é¢˜
  ä¾‹: "ä»‹ç»ä¸€ä¸‹Python", "å¦‚ä½•å­¦ä¹ ç¼–ç¨‹"
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **è®°å¿†ç®¡ç†**
   - å®šæœŸæ¸…ç†ä¸ç›¸å…³çš„è®°å¿†
   - ä½¿ç”¨ `clear_all_memory()` é‡ç½®

2. **æœç´¢ä¼˜åŒ–**
   - æ˜ç¡®æœç´¢å…³é”®è¯
   - é™åˆ¶æœç´¢ç»“æœæ•°é‡ï¼ˆé»˜è®¤5æ¡ï¼‰

3. **æ–‡ä»¶æ“ä½œ**
   - æ–‡ä»¶ç»Ÿä¸€å­˜æ”¾åœ¨ `workspace/` ç›®å½•
   - é¿å…æ“ä½œæ•æ„Ÿæ–‡ä»¶

## æ•…éšœæ’é™¤

### é—®é¢˜1: LangGraphå¯¼å…¥å¤±è´¥
```
è§£å†³: pip install langgraph>=0.0.20
```

### é—®é¢˜2: æœç´¢åŠŸèƒ½ä¸å¯ç”¨
```
è§£å†³: 
1. å®‰è£… duckduckgo-search: pip install duckduckgo-search
2. æˆ–é…ç½® SERPER_API_KEY ç¯å¢ƒå˜é‡
```

### é—®é¢˜3: æ–‡ä»¶æ“ä½œæƒé™é”™è¯¯
```
è§£å†³: ç¡®ä¿ workspace/ ç›®å½•æœ‰è¯»å†™æƒé™
```

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°å·¥å…·

1. åœ¨ `tools.py` ä¸­åˆ›å»ºæ–°å·¥å…·ç±»
2. åœ¨ `langgraph_agent.py` ä¸­åˆå§‹åŒ–å·¥å…·
3. åœ¨ `_analyze_intent` ä¸­æ·»åŠ æ–°æ„å›¾
4. åœ¨çŠ¶æ€å›¾ä¸­æ·»åŠ æ–°èŠ‚ç‚¹

ç¤ºä¾‹ - æ·»åŠ ç¿»è¯‘å·¥å…·:

```python
# tools.py
class Translator:
    def translate(self, text, target_lang):
        # ç¿»è¯‘é€»è¾‘
        pass

# langgraph_agent.py
def _translate(self, state: AgentState):
    result = self.translator.translate(...)
    return state
```

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **ç¯å¢ƒå˜é‡é…ç½®**
   ```bash
   OPENAI_API_KEY=your_deepseek_key
   OPENAI_BASE_URL=https://api.deepseek.com
   USE_LANGGRAPH=true
   SERPER_API_KEY=your_serper_key  # å¯é€‰
   ```

2. **å¯åŠ¨æœåŠ¡**
   ```bash
   uvicorn main:app --host 0.0.0.0 --port 8000
   ```

3. **Dockeréƒ¨ç½²**
   ```dockerfile
   FROM python:3.10
   WORKDIR /app
   COPY requirements.txt .
   RUN pip install -r requirements.txt
   COPY . .
   ENV USE_LANGGRAPH=true
   CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
   ```

## æ³¨æ„äº‹é¡¹

1. âš ï¸ **APIæˆæœ¬**: æœç´¢å’Œå¤æ‚æ¨ç†ä¼šå¢åŠ LLMè°ƒç”¨æ¬¡æ•°
2. âš ï¸ **éšç§å®‰å…¨**: ä¸è¦å¤„ç†æ•æ„Ÿæ–‡ä»¶å’Œæ•°æ®
3. âš ï¸ **ç½‘ç»œå»¶è¿Ÿ**: æœç´¢åŠŸèƒ½éœ€è¦ç½‘ç»œè¿æ¥
4. âš ï¸ **å·¥ä½œç©ºé—´**: æ–‡ä»¶æ“ä½œé™åˆ¶åœ¨workspaceç›®å½•å†…

## æ›´å¤šèµ„æº

- LangGraphæ–‡æ¡£: https://langchain-ai.github.io/langgraph/
- LangChainæ–‡æ¡£: https://python.langchain.com/
- DeepSeek API: https://platform.deepseek.com/
